class Calculator{constructor(t,e,s,a,l){this.startStep=e,this.forms=t;this.data={};let r=this.tabs=document.querySelectorAll(s),o=(this.btnTabs=document.querySelector(a),this.glob=this),c=this.stepControl=document.querySelector(l);for(let t=0;t<r.length;t++)this.createDots(c);let i=this.dots=document.querySelectorAll(".popup-calculator__step");this.showStep(e),i.forEach((t,e)=>{t.addEventListener("click",(function(){o.showStep(o.startStep=e+1)}))}),this.btnTabs.addEventListener("click",(function(){o.startStep<r.length?o.showStep(o.startStep+=1):(this.type="submit",t.addEventListener("submit",t=>o.sendCalculatorForm(t)))}));for(let t=0;t<r.length;t++)r[t].addEventListener("click",(function(t){let e=t.target;o.btnTabs.disabled=!0,o.btnTabs.classList.remove("popup-calculator__btn_active"),"INPUT"===e.tagName&&(this.dataset.tabs=!0,o.checkTabs("[data-place],[data-roller],[data-size]"))}))}createDots(t){let e=document.createElement("span");e.classList.add("popup-calculator__step"),t.append(e)}showStep(t){t>this.dots.length&&(this.startStep=1),t<1&&(this.startStep=this.dots.length),t==this.dots.length?this.btnTabs.innerHTML="Узнать цену":this.btnTabs.innerHTML="Далее",this.clearActiveClass(),this.btnTabs.disabled=!0,this.btnTabs.classList.remove("popup-calculator__btn_active"),this.tabs[this.startStep-1].classList.add("popup-calculator__tabs_active"),this.dots[this.startStep-1].classList.add("popup-calculator__step_active")}clearActiveClass(){for(let t=0;t<this.dots.length;t++)this.dots[t].classList.remove("popup-calculator__step_active"),this.tabs[t].classList.remove("popup-calculator__tabs_active")}sendCalculatorForm(t){if(t.preventDefault(),!this.validForm())return;localStorage.clear();let e=document.createElement("div");e.classList.add("form__message");let s=new XMLHttpRequest;s.open("POST","https://https://gipsolit-site.herokuapp.com/calc"),s.setRequestHeader("Content-type","application/json; charset = utf-8"),s.send(JSON.stringify(this.data));let a=this.forms,l=this.startStep,r=this.glob;this.forms.append(e),s.addEventListener("readystatechange",(function(){if(s.readyState<4);else if(4===s.readyState&&200===s.status){let t=JSON.parse(s.response);(new Popup).showPopup("#popup-result"),alert(`${t.place}, ${t.roller}, ${t.result.min} // ${t.result.all}  `),r.showStep(l=r.tabs.length+1),a.removeChild(e)}else e.innerText=(new SendForm).message.error}))}clearChecks(t){document.querySelectorAll(t).forEach(t=>{t.checked=!1})}checkTabs(t){let e,s=this;for(let s=0;s<t.split(",").length;s++)e=document.querySelectorAll(t);e.forEach(e=>{e.addEventListener("change",(function(){s.clearChecks(t),e.checked=!0;for(let t in e.dataset)"tabs"!==t&&(s.data[t]=e.dataset[t]);s.btnTabs.disabled=!1,s.btnTabs.classList.add("popup-calculator__btn_active"),localStorage.setItem("obj",JSON.stringify(s.data))}))})}validForm(){for(let t=0;t<this.tabs.length;t++)return"true"===this.tabs[t].dataset.tabs}}